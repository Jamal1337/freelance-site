---
import Layout from '../../layouts/Layout.astro';
import Hero from '../../components/de/Hero.astro';
import Metrics from '../../components/de/Metrics.astro';
import ServicesSimple from '../../components/de/ServicesSimple.astro';
import Portfolio from '../../components/de/Portfolio.astro';
import Process from '../../components/de/Process.astro';
import About from '../../components/de/About.astro';
import Contact from '../../components/de/Contact.astro';
---

<Layout
  title="Fabian Eppinger - E-Commerce Entwickler"
  description="Individuelle Automatisierung, Integrationen und Softwareentwicklung für E-Commerce Marken. Standort Deutschland, weltweit tätig."
  lang="de"
>
  <Hero />
  <Metrics />
  <ServicesSimple />
  <Portfolio />
  <Process />
  <About />
  <Contact />

  <!-- GSAP and ScrollTrigger for animations -->
  <script>
    import gsap from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';

    gsap.registerPlugin(ScrollTrigger);

    document.addEventListener('DOMContentLoaded', () => {

      gsap.utils.toArray('.fade-in').forEach((element) => {
        gsap.fromTo(element,
          { opacity: 0, y: 20 },
          {
            opacity: 1,
            y: 0,
            duration: 1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: element,
              start: 'top 80%',
              end: 'bottom 20%',
              toggleActions: 'play none none reverse'
            }
          }
        );
      });

      gsap.utils.toArray('.slide-up').forEach((element, index) => {
        gsap.fromTo(element,
          { opacity: 0, y: 40 },
          {
            opacity: 1,
            y: 0,
            duration: 0.8,
            delay: index * 0.1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: element,
              start: 'top 85%',
              end: 'bottom 15%',
              toggleActions: 'play none none reverse'
            }
          }
        );
      });

      gsap.utils.toArray('.scale-in').forEach((element, index) => {
        gsap.fromTo(element,
          { opacity: 0, scale: 0.9 },
          {
            opacity: 1,
            scale: 1,
            duration: 0.6,
            delay: index * 0.1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: element,
              start: 'top 80%',
              end: 'bottom 20%',
              toggleActions: 'play none none reverse'
            }
          }
        );
      });

      gsap.to('.hero-shape', {
        yPercent: -50,
        ease: 'none',
        scrollTrigger: {
          trigger: '.hero',
          start: 'top top',
          end: 'bottom top',
          scrub: true
        }
      });

      const serviceCards = gsap.utils.toArray('.service-card');
      if (serviceCards.length) {
        gsap.fromTo(serviceCards,
          { opacity: 0, y: 30 },
          {
            opacity: 1,
            y: 0,
            duration: 0.6,
            stagger: 0.1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: '.services-grid',
              start: 'top 70%'
            }
          }
        );
      }

      const caseCards = gsap.utils.toArray('.case-card');
      if (caseCards.length) {
        gsap.fromTo(caseCards,
          { opacity: 0, y: 40, scale: 0.95 },
          {
            opacity: 1,
            y: 0,
            scale: 1,
            duration: 0.8,
            stagger: 0.15,
            ease: 'power3.out',
            scrollTrigger: {
              trigger: '.cases-grid',
              start: 'top 70%'
            }
          }
        );
      }

      const processSteps = gsap.utils.toArray('.process-step');
      if (processSteps.length) {
        processSteps.forEach((step, index) => {
          gsap.fromTo(step,
            { opacity: 0, x: -30 },
            {
              opacity: 1,
              x: 0,
              duration: 0.6,
              delay: index * 0.15,
              ease: 'power2.out',
              scrollTrigger: {
                trigger: step,
                start: 'top 80%'
              }
            }
          );
        });
      }

      const pricingCards = gsap.utils.toArray('.pricing-card');
      if (pricingCards.length) {
        gsap.fromTo(pricingCards,
          { opacity: 0, y: 30, scale: 0.95 },
          {
            opacity: 1,
            y: 0,
            scale: 1,
            duration: 0.8,
            stagger: 0.1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: '.pricing-grid',
              start: 'top 70%'
            }
          }
        );
      }

      const statNumbers = gsap.utils.toArray('.stat-number');
      statNumbers.forEach((stat) => {
        const text = stat.textContent;
        if (text && text.includes('100k')) {
          gsap.fromTo(stat,
            { textContent: 0 },
            {
              textContent: 100,
              duration: 2,
              ease: 'power2.out',
              snap: { textContent: 1 },
              scrollTrigger: {
                trigger: stat,
                start: 'top 80%'
              },
              onUpdate: function() {
                stat.textContent = Math.floor(this.targets()[0].textContent) + 'k+';
              }
            }
          );
        }
      });

      ScrollTrigger.config({
        limitCallbacks: true,
        syncInterval: 40
      });

      window.addEventListener('resize', () => {
        ScrollTrigger.refresh();
      });
    });
  </script>
</Layout>
