---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import Metrics from '../components/Metrics.astro';
import ServicesSimple from '../components/ServicesSimple.astro';
// import Services from '../components/Services.astro'; // Hidden - funnel visualization kept for future use
// import CaseStudies from '../components/CaseStudies.astro'; // Hidden - kept for future use
import Portfolio from '../components/Portfolio.astro';
import Process from '../components/Process.astro';
import About from '../components/About.astro';
import Pricing from '../components/Pricing.astro';
import Clients from '../components/Clients.astro';
import Contact from '../components/Contact.astro';
---

<Layout
  title="Fabian Eppinger - E-commerce Developer"
  description="Custom automation, integrations, and software development for e-commerce brands. Based in Germany, working globally."
  lang="en"
>
  <Hero />
  <Metrics />
  <ServicesSimple />
  <!-- <CaseStudies /> -->
  <Portfolio />
  <Process />
  <About />
  <Pricing />
  <Clients />
  <Contact />
  
  <!-- GSAP and ScrollTrigger for animations -->
  <script>
    import gsap from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';
    
    gsap.registerPlugin(ScrollTrigger);
    
    // Wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', () => {
      
      // Fade in animations
      gsap.utils.toArray('.fade-in').forEach((element) => {
        gsap.fromTo(element, 
          {
            opacity: 0,
            y: 20
          },
          {
            opacity: 1,
            y: 0,
            duration: 1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: element,
              start: 'top 80%',
              end: 'bottom 20%',
              toggleActions: 'play none none reverse'
            }
          }
        );
      });
      
      // Slide up animations
      gsap.utils.toArray('.slide-up').forEach((element, index) => {
        gsap.fromTo(element,
          {
            opacity: 0,
            y: 40
          },
          {
            opacity: 1,
            y: 0,
            duration: 0.8,
            delay: index * 0.1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: element,
              start: 'top 85%',
              end: 'bottom 15%',
              toggleActions: 'play none none reverse'
            }
          }
        );
      });
      
      // Scale in animations
      gsap.utils.toArray('.scale-in').forEach((element, index) => {
        gsap.fromTo(element,
          {
            opacity: 0,
            scale: 0.9
          },
          {
            opacity: 1,
            scale: 1,
            duration: 0.6,
            delay: index * 0.1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: element,
              start: 'top 80%',
              end: 'bottom 20%',
              toggleActions: 'play none none reverse'
            }
          }
        );
      });
      
      // Parallax effect for hero section
      gsap.to('.hero-shape', {
        yPercent: -50,
        ease: 'none',
        scrollTrigger: {
          trigger: '.hero',
          start: 'top top',
          end: 'bottom top',
          scrub: true
        }
      });
      
      // Stagger animations for cards
      const serviceCards = gsap.utils.toArray('.service-card');
      if (serviceCards.length) {
        gsap.fromTo(serviceCards,
          {
            opacity: 0,
            y: 30
          },
          {
            opacity: 1,
            y: 0,
            duration: 0.6,
            stagger: 0.1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: '.services-grid',
              start: 'top 70%'
            }
          }
        );
      }
      
      // Case study cards animation
      const caseCards = gsap.utils.toArray('.case-card');
      if (caseCards.length) {
        gsap.fromTo(caseCards,
          {
            opacity: 0,
            y: 40,
            scale: 0.95
          },
          {
            opacity: 1,
            y: 0,
            scale: 1,
            duration: 0.8,
            stagger: 0.15,
            ease: 'power3.out',
            scrollTrigger: {
              trigger: '.cases-grid',
              start: 'top 70%'
            }
          }
        );
      }
      
      // Process timeline animation
      const processSteps = gsap.utils.toArray('.process-step');
      if (processSteps.length) {
        processSteps.forEach((step, index) => {
          gsap.fromTo(step,
            {
              opacity: 0,
              x: -30
            },
            {
              opacity: 1,
              x: 0,
              duration: 0.6,
              delay: index * 0.15,
              ease: 'power2.out',
              scrollTrigger: {
                trigger: step,
                start: 'top 80%'
              }
            }
          );
        });
      }
      
      // Pricing cards animation
      const pricingCards = gsap.utils.toArray('.pricing-card');
      if (pricingCards.length) {
        gsap.fromTo(pricingCards,
          {
            opacity: 0,
            y: 30,
            scale: 0.95
          },
          {
            opacity: 1,
            y: 0,
            scale: 1,
            duration: 0.8,
            stagger: 0.1,
            ease: 'power2.out',
            scrollTrigger: {
              trigger: '.pricing-grid',
              start: 'top 70%'
            }
          }
        );
      }
      
      // Number counter animation for stats
      const statNumbers = gsap.utils.toArray('.stat-number');
      statNumbers.forEach((stat) => {
        const text = stat.textContent;
        if (text && text.includes('100k')) {
          gsap.fromTo(stat,
            {
              textContent: 0
            },
            {
              textContent: 100,
              duration: 2,
              ease: 'power2.out',
              snap: { textContent: 1 },
              scrollTrigger: {
                trigger: stat,
                start: 'top 80%'
              },
              onUpdate: function() {
                stat.textContent = Math.floor(this.targets()[0].textContent) + 'k+';
              }
            }
          );
        }
      });
      
      // Smooth scroll behavior
      ScrollTrigger.config({
        limitCallbacks: true,
        syncInterval: 40
      });
      
      // Refresh ScrollTrigger on window resize
      window.addEventListener('resize', () => {
        ScrollTrigger.refresh();
      });
    });
  </script>
</Layout>