---
export interface Props {
  title: string;
  description?: string;
  lang?: 'en' | 'de';
  canonicalUrl?: string;
  ogImage?: string;
  solidNav?: boolean;
}

const {
  title,
  description = "Freelance developer & performance marketer. Shopify, custom software, landing pages, and marketing tools for e-commerce and lead generation. Based in Germany.",
  lang = 'en',
  canonicalUrl,
  ogImage = '/images/og-image.png',
  solidNav = false
} = Astro.props;

const siteUrl = 'https://fabianeppinger.com';
const currentUrl = canonicalUrl || Astro.url.pathname;
const fullCanonicalUrl = `${siteUrl}${currentUrl}`;
const fullOgImage = ogImage.startsWith('http') ? ogImage : `${siteUrl}${ogImage}`;

// Alternate language URLs
const enUrl = currentUrl.replace('/de/', '/').replace('/de', '/');
const deUrl = currentUrl.startsWith('/de') ? currentUrl : `/de${currentUrl === '/' ? '' : currentUrl}`;

// Navigation based on language
const navItems = lang === 'de'
  ? { services: 'Leistungen', work: 'Projekte', about: 'Über mich', contact: 'Kontakt' }
  : { services: 'Services', work: 'Work', about: 'About', contact: 'Contact' };
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="author" content="Fabian Eppinger" />
    <meta name="robots" content="index, follow" />
    <meta name="generator" content={Astro.generator} />

    <!-- Canonical & Language Alternates -->
    <link rel="canonical" href={fullCanonicalUrl} />
    <link rel="alternate" hreflang="en" href={`${siteUrl}${enUrl}`} />
    <link rel="alternate" hreflang="de" href={`${siteUrl}${deUrl}`} />
    <link rel="alternate" hreflang="x-default" href={`${siteUrl}${enUrl}`} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={fullCanonicalUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={fullOgImage} />
    <meta property="og:locale" content={lang === 'de' ? 'de_DE' : 'en_US'} />
    <meta property="og:site_name" content="Fabian Eppinger" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={fullCanonicalUrl} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={fullOgImage} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#0c0c0c" />

    <!-- Geo Tags for Local SEO -->
    <meta name="geo.region" content="DE" />
    <meta name="geo.country" content="Germany" />

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "ProfessionalService",
      "name": "Fabian Eppinger",
      "description": description,
      "url": siteUrl,
      "logo": `${siteUrl}/images/fabian-profile.webp`,
      "image": `${siteUrl}/images/fabian-profile.webp`,
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "DE"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "addressCountry": "Germany"
      },
      "priceRange": "€€€",
      "serviceType": ["Custom Software", "Shopify Development", "Landing Pages", "Marketing Tools", "Performance Marketing"],
      "areaServed": {
        "@type": "Place",
        "name": "Worldwide"
      },
      "founder": {
        "@type": "Person",
        "name": "Fabian Eppinger",
        "jobTitle": "Freelance Developer & Performance Marketer",
        "url": siteUrl,
        "sameAs": [
          "https://www.linkedin.com/in/fabian-eppinger-756142ab/"
        ]
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "email": "fabian.eppinger@icloud.com",
        "contactType": "sales",
        "availableLanguage": ["English", "German"]
      }
    })} />
  </head>
  <body>
    <!-- Navigation -->
    <nav class={`nav ${solidNav ? 'nav-solid' : ''}`} id="navigation">
      <div class="nav-container">
        <a href={lang === 'de' ? '/de' : '/'} class="nav-logo">
          <span class="logo-text">FE</span>
          <span class="logo-dot">.</span>
        </a>
        <ul class="nav-menu">
          <li><a href="#services" class="nav-link">{navItems.services}</a></li>
          <li><a href="#portfolio" class="nav-link">{navItems.work}</a></li>
          <li><a href="#about" class="nav-link">{navItems.about}</a></li>
        </ul>
        <div class="nav-right">
          <!-- Language Switcher -->
          <div class="lang-switcher">
            <a href={enUrl} class={`lang-link ${lang === 'en' ? 'active' : ''}`}>EN</a>
            <span class="lang-divider">/</span>
            <a href={`/de${enUrl === '/' ? '' : enUrl}`} class={`lang-link ${lang === 'de' ? 'active' : ''}`}>DE</a>
          </div>
          <a href="#contact" class="nav-cta">{navItems.contact}</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main>
      <slot />
    </main>

    <!-- GSAP ScrollTrigger will be loaded here -->
    <script>
      // Add scroll effect to navigation
      window.addEventListener('scroll', () => {
        const nav = document.getElementById('navigation');
        if (window.scrollY > 50) {
          nav.classList.add('nav-scrolled');
        } else {
          nav.classList.remove('nav-scrolled');
        }
      });

      // Smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
    </script>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';

  html, body {
    width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
  }

  main {
    width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
  }

  /* Language Switcher */
  .nav-right {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .lang-switcher {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-family: var(--font-mono);
    font-size: 0.75rem;
  }

  .lang-link {
    color: var(--color-gray);
    text-decoration: none;
    padding: 0.25rem 0.5rem;
    transition: color 0.3s ease;
  }

  .lang-link:hover,
  .lang-link.active {
    color: var(--color-black);
  }

  .lang-divider {
    color: var(--color-gray);
  }

  @media (max-width: 768px) {
    .lang-switcher {
      display: none;
    }
  }
</style>
